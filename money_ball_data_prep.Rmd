---
title: "world money_ball - kaggle dataset"
author: "patrick mcdevitt (& collaboration with preeti swaminathan)"
date: "04 juin 2017"
output: pdf_document
classoption: landscape
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())

library(ggplot2)
library(MASS)
library(car)
library(moments)
library(cowplot)
library(grid)
library(gridExtra)

home_dir <- "~/_smu/_src/money_ball/"
setwd(home_dir)

data_dir <- "./data"

```

## money_ball - Regression Project -


### __Intro__  

*** 
The following __Context__ and __Content__ is from : https://www.kaggle.com/unsdsn/world-money_ball  



#### __Objective__

Within the context of __World money_ball Day__ explore the data available from the the United Nations survey and idneitfy the characteristics that are associated with higher __money_ball__ scores

*** 
### __Descriptive statistics__  

*** 

### __Analysis__  

*** 

### __Interpretation__  

*** 

### __Conclusion__  

*** 


  
  
#### __Setup some data directories  

```{r read data, include = FALSE, message = FALSE}

	setwd(home_dir)
	setwd(data_dir)

	mlb <- read.csv("moneyball.csv", stringsAsFactors = FALSE)
	setwd(home_dir)

	names(mlb) <- tolower(names(mlb))
	
	for (i in 2:(length(mlb)))
	{
		if (class(mlb[,i]) == "character")
		{
			mlb[,i] <- factor (mlb[,i])
		}
	}
```

#### __Remove extreme outliers from each column of numerical data__  

```{r remove outliers, include = FALSE, message = FALSE}

# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
# ...	remove outliers ... more than 5 sigma from mean value
# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	
	for (i in 3 : length(mlb))
	{
		if(class(mlb[,i]) == "integer" || class(mlb[,i]) == "numeric")
		{
			mlb[,i][which(scale(mlb[,i]) > 5)] <- NA
			mlb[,i][which(scale(mlb[,i]) < -5)] <- NA
		}
	}

```

```{r plot base data, echo = FALSE, message = FALSE, comment = "", fig.width = 12}

# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
# ...	make some plots for numeric variables .....
# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

	cx_scale = 1
# ... 	use cx_scale = 1 for in-line html knitted docs
# ...	use cx_scale = 3 for pdf landscape mode knitted docs

	par (mfrow = c (1, 2))

	plot(mlb$target_wins, col = "darkgoldenrod",
		cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
	  	xlab = names(mlb[i]),
	  	main = "Dependent variable - Target Wins sequence")

	plot(mlb$target_wins/162, col = "sienna3",
		cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
	  	xlab = names(mlb[i]),
	  	main = "Dependent variable - Percentage Wins")

	for (i in 3 : length(mlb))
	{
		if(class(mlb[,i]) == "integer" || class(mlb[,i]) == "numeric" || class(mlb[,i]) == "matrix")
		{
				  
#			png (filename = paste0(names(mlb[i]), "_%02d.png"), width = 1800, height = 600)
			par (mfrow = c (1, 4))

			plot(mlb[,i], col = "cyan",
				 cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
				  	xlab = names(mlb[i]),
				  	main = "Independent variable sequence")

			hist(mlb[,i], main = names(mlb[i]), cex.lab = cx_scale, cex.main = cx_scale)
			if (skewness(mlb[,i], na.rm = TRUE) < 0)
			{
				txt_pos <- "topleft"
			}
			else {
				txt_pos <- "topright"
			}
			legend(txt_pos, legend = c(paste("Mean =", round(mean(mlb[,i], na.rm = TRUE), 1)),
                            paste("Median =",round(median(mlb[,i], na.rm = TRUE), 1)),
                            paste("Std.Dev =", round(sd(mlb[,i], na.rm = TRUE), 1)), 
                            paste("Skewness =", round(skewness(mlb[,i], na.rm = TRUE), 1))), 
                  bty = "n", cex = cx_scale)
			
			
			plot(mlb$target_wins  ~ mlb[,i], col = "blue", cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
				 	ylab = "money_ball Score",
				  	xlab = names(mlb[i]),
				  	main = "Independent variable vs. money_ball Score")
			abline(lm(mlb$target_wins ~ mlb[,i]))

# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
# ...	look at residuals from one-variable linear fit			
# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

			fit <- lm(mlb$target_wins ~ mlb[,i], na.action = na.exclude)
			res <- resid(fit)
			plot (mlb[,i], res, cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
				  ylab = "Residuals",
				  xlab = names(mlb[i]),
				  main = "Residuals from Linear Fit",
				  col = "magenta")
			abline (0, 0)
			
		}
#		dev.off()
	}

```


```{r plot first transforms, echo = FALSE, message = FALSE, comment = "", fig.width = 12}

# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
# ...	ln-transform if skewness >= 1
# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

	cx_scale = 1
# ... 	use cx_scale = 1 for in-line html knitted docs
# ...	use cx_scale = 3 for pdf landscape mode knitted docs


	for (i in 3 : length(mlb))
	{
		print(i)
		if(class(mlb[,i]) == "integer" || class(mlb[,i]) == "numeric" || class(mlb[,i]) == "matrix")
		{
				  
#			png (filename = paste0(names(mlb[i]), "_%02d.png"), width = 1800, height = 600)
			par (mfrow = c (1, 4))
			
			if (skewness(mlb[,i], na.rm = TRUE) >= 1)
			{

				plot(log(mlb[,i]), col = "cyan",
					cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
				  	xlab = names(mlb[i]),
				  	main = "Independent variable sequence")

				hist(log(mlb[,i]), main = names(mlb[i]), cex.lab = cx_scale, cex.main = cx_scale)
				if (skewness(log(mlb[,i]), na.rm = TRUE) < 0)
				{
					txt_pos <- "topleft"
				}
				else {
					txt_pos <- "topright"
				}
				legend(txt_pos, legend = c(paste("Mean =", round(mean(mlb[,i], na.rm = TRUE), 1)),
								paste("Median =",round(median(mlb[,i], na.rm = TRUE), 1)),
    	                        paste("Std.Dev =", round(sd(mlb[,i], na.rm = TRUE), 1)), 
    	                        paste("Skewness =", round(skewness(mlb[,i], na.rm = TRUE), 1))), 
    	            			bty = "n", cex = cx_scale)
			
			
				plot(mlb$target_wins  ~ log(mlb[,i]), col = "blue",
					 cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
				 	 ylab = "money_ball Score",
				  	 xlab = names(mlb[i]),
				  	 main = "Independent variable vs. money_ball Score")
				abline(lm(mlb$target_wins ~ log(mlb[,i])))

# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
# ...	look at residuals from one-variable linear fit			
# ...	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

				fit <- lm(mlb$target_wins ~ log(mlb[,i]), na.action = na.exclude)
				res <- resid(fit)
				plot (log(mlb[,i]), res,
					  cex = cx_scale, cex.lab = cx_scale, cex.axis = cx_scale, cex.main = cx_scale,
					  ylab = "Residuals",
					  xlab = names(mlb[i]),
					  main = "Residuals from Linear Fit",
					  col = "magenta")
				abline (0, 0)
			}
			
		}
#		dev.off()
	}

```
#### __Make first data visualization plot for each column of dataset__  
